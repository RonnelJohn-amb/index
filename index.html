<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valentine Chest Animation</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  overflow: hidden;
  background: linear-gradient(135deg, #3b0d5c, #6b3f95);
  font-family: 'Montserrat', sans-serif;
}

.container {
  position: relative;
  width: 100%;
  height: 100%;
}

.chest {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  cursor: pointer;
  z-index: 2;
}

#openText {
  position: absolute;
  left: 50%;
  top: calc(50% + 100px);
  transform: translate(-50%, 0);
  font-size: 36px;
  font-weight: bold;
  color: #ffccff;
  user-select: none;
  pointer-events: none;
  transition: transform 0.3s ease, font-size 0.3s ease;
  z-index: 1;
}

#loveText {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  font-size: 48px;
  color: #ff99ff;
  text-shadow: 0 0 20px #ff66ff;
  z-index: 3;
  text-align: center;
  white-space: pre-line;
  transition: transform 2s ease-out;
}

#effects {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 4;
  overflow: hidden;
}

.flying-butterfly {
  position: absolute;
  width: 40px;
  height: 40px;
  fill: #aa55ff;
  z-index: 5;
}
</style>
</head>

<body>
<div class="container">

  <div class="chest" id="chest">
    <svg width="200" height="150" viewBox="0 0 200 150">
      <rect x="20" y="70" width="160" height="60" rx="10"
            fill="#6b3f95" stroke="#4b2170" stroke-width="4"/>
      <rect id="chest-lid" x="20" y="40" width="160" height="40" rx="10"
            fill="#7e4cb0" stroke="#4b2170" stroke-width="4"/>
    </svg>
  </div>

  <div id="openText">OPEN</div>
  <div id="loveText">Happy Valentines Day! I LOVE YOU LAB!</div>
  <div id="effects"></div>

</div>

<script>
const chest = document.getElementById('chest');
const chestLid = document.getElementById('chest-lid');
const loveText = document.getElementById('loveText');
const openText = document.getElementById('openText');
const effects = document.getElementById('effects');

/* ---------------- OPEN TEXT DODGE ---------------- */
let dodgeCount = 0;

document.addEventListener('mousemove', e => {
  const r = openText.getBoundingClientRect();
  const dx = e.clientX - (r.left + r.width / 2);
  const dy = e.clientY - (r.top + r.height / 2);
  if (Math.hypot(dx, dy) < 100) {
    dodgeCount++;
    openText.style.fontSize =
      Math.max(36 - dodgeCount * 1.5, 18) + "px";

    openText.style.transform =
      `translate(${(Math.random()-0.5)*400}px, ${(Math.random()-0.5)*400}px)`;
  }
});

/* ---------------- 5 CLICK CHEST LOGIC ---------------- */
let clickCount = 0;
let opened = false;

chest.addEventListener('click', () => {
  if (opened) return;

  clickCount++;

  /* small shake feedback (no UI text) */
  chest.style.transform =
    'translate(-50%, -50%) scale(0.97)';
  setTimeout(() => {
    chest.style.transform = 'translate(-50%, -50%)';
  }, 80);

  if (clickCount < 5) return;

  opened = true;

  chestLid.style.transition = 'transform 1s ease';
  chestLid.style.transformOrigin = 'bottom center';
  chestLid.style.transform = 'rotateX(-120deg)';

  setTimeout(() => {
    loveText.style.transform =
      'translate(-50%, -50%) scale(1)';
    startContinuousRain();
    startFlyingButterflies();
  }, 1000);
});

/* ---------------- FALLING ELEMENTS ---------------- */
function createFallingElement() {
  const types = ['heart','butterfly','petal'];
  const type = types[Math.floor(Math.random()*types.length)];

  const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
  const size = 20 + Math.random()*15;
  svg.setAttribute('width', size);
  svg.setAttribute('height', size);

  let shape;
  if (type === 'heart') {
    shape = document.createElementNS("http://www.w3.org/2000/svg","path");
    shape.setAttribute('d',
      'M10 3 C10 -2 0 -2 0 3 C0 8 10 18 10 18 C10 18 20 8 20 3 C20 -2 10 -2 10 3');
    shape.setAttribute('fill','#cc66ff');
  } else if (type === 'butterfly') {
    shape = document.createElementNS("http://www.w3.org/2000/svg","path");
    shape.setAttribute('d','M0,10 C5,0 15,0 20,10 C15,20 5,20 0,10 Z');
    shape.setAttribute('fill','#aa55ff');
  } else {
    shape = document.createElementNS("http://www.w3.org/2000/svg","ellipse");
    shape.setAttribute('cx',size/2);
    shape.setAttribute('cy',size/2);
    shape.setAttribute('rx',size/2);
    shape.setAttribute('ry',size/3);
    shape.setAttribute('fill','#dd99ff');
  }

  svg.appendChild(shape);
  svg.style.position = 'absolute';
  svg.style.left = Math.random()*innerWidth + 'px';
  svg.style.top = '-30px';
  svg.style.opacity = 0.8;
  svg.style.transition = 'transform 5s linear, opacity 2s ease';
  effects.appendChild(svg);

  setTimeout(() => {
    svg.style.transform =
      `translateY(${innerHeight+60}px)
       translateX(${Math.random()*60-30}px)
       rotate(${Math.random()*360}deg)`;
    svg.style.opacity = 0;
  }, 50);

  setTimeout(() => svg.remove(), 6000);
}

function startContinuousRain() {
  setInterval(createFallingElement, 200);
}

/* ---------------- FLYING BUTTERFLIES ---------------- */
function startFlyingButterflies() {
  for (let i=0;i<6;i++) createFlyingButterfly(i*150);
}

function createFlyingButterfly(delay) {
  const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
  svg.setAttribute('width','40');
  svg.setAttribute('height','40');
  svg.classList.add('flying-butterfly');

  const cx=20, cy=20;

  const left = document.createElementNS("http://www.w3.org/2000/svg","path");
  left.setAttribute('d',`M${cx},${cy} C5,5 2,15 10,20 C2,25 5,35 ${cx},${cy}`);
  left.setAttribute('fill','#aa55ff');

  const right = document.createElementNS("http://www.w3.org/2000/svg","path");
  right.setAttribute('d',`M${cx},${cy} C35,5 38,15 30,20 C38,25 35,35 ${cx},${cy}`);
  right.setAttribute('fill','#aa55ff');

  svg.append(left,right);
  document.body.appendChild(svg);

  let x=Math.random()*innerWidth;
  let dir=Math.random()>0.5?1:-1;
  let speed=1+Math.random();

  function move(){
    x+=dir*speed;
    if(x<0||x>innerWidth)dir*=-1;
    svg.style.left=x+'px';
    svg.style.bottom=30+Math.sin(x/50)*20+'px';
    requestAnimationFrame(move);
  }

  function flap(){
    left.setAttribute('transform','scale(1,0.7)');
    right.setAttribute('transform','scale(1,0.7)');
    setTimeout(()=>{
      left.setAttribute('transform','scale(1,1)');
      right.setAttribute('transform','scale(1,1)');
    },120);
    setTimeout(flap,240);
  }

  setTimeout(()=>{move();flap();},delay);
}
</script>
</body>
</html>
