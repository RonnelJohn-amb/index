<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine's Surprise</title>
    <style>
        :root {
            --deep-violet: #9b67e6;
            --envelope-bg: #fff0f5;
            --orchid-pink: #da70d6;
            --siamese-cream: #f5ebe0;
            --siamese-dark: #5d4037;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: radial-gradient(circle, #fff0f5 0%, #ffdee9 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- Layout Container --- */
        .main-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 40px; 
            position: relative;
        }

        /* --- Envelope --- */
        #envelope-container {
            position: relative;
            width: 300px;
            height: 200px;
            background-color: var(--envelope-bg);
            border: 2px solid #f8bbd0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            cursor: pointer;
            border-radius: 4px;
            z-index: 10;
        }

        #envelope-container::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 0; height: 0;
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-top: 100px solid #f48fb1;
            z-index: 1;
        }

        /* --- The "Dodge" Button Area --- */
        .button-zone {
            width: 300px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        #dodge-btn {
            position: absolute;
            padding: 12px 40px;
            background-color: var(--deep-violet);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            /* Faster transition for more reactive dodging */
            transition: all 0.2s ease-out; 
            z-index: 20;
            box-shadow: 0 4px 15px rgba(155, 103, 230, 0.4);
            white-space: nowrap;
            /* Prevents long-press menu on mobile */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* --- Full Body Siamese Cat --- */
        #cat-container {
            position: fixed;
            bottom: -300px;
            right: 40px;
            width: 180px;
            height: 220px;
            transition: bottom 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100;
        }

        .cat-body {
            position: absolute;
            width: 100px;
            height: 120px;
            background: var(--siamese-cream);
            border-radius: 50% 50% 30% 30%;
            bottom: 0; left: 40px;
            border: 2px solid #e0d5c8;
        }

        .cat-head {
            position: absolute;
            width: 85px; height: 75px;
            background: var(--siamese-cream);
            border-radius: 50%;
            top: -40px; left: 7px;
            border: 2px solid #e0d5c8;
        }

        .cat-face-mask {
            position: absolute;
            width: 55px; height: 40px;
            background: var(--siamese-dark);
            border-radius: 50%;
            top: 25px; left: 15px;
            z-index: 2;
        }

        .eye { position: absolute; width: 8px; height: 8px; background: white; border-radius: 50%; top: 32px; z-index: 3; }
        .eye.left { left: 25px; }
        .eye.right { right: 25px; }
        .nose { position: absolute; width: 6px; height: 4px; background: #222; border-radius: 50%; top: 45px; left: 50%; transform: translateX(-50%); z-index: 3; }

        .ear {
            position: absolute; width: 0; height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-bottom: 28px solid var(--siamese-dark);
            top: -12px;
        }
        .ear.left { left: 0px; transform: rotate(-20deg); }
        .ear.right { right: 0px; transform: rotate(20deg); }

        .tail {
            position: absolute; width: 60px; height: 15px;
            background: var(--siamese-dark);
            border-radius: 10px;
            right: 0px; bottom: 40px;
            transform-origin: left center;
            animation: tailWag 2s infinite ease-in-out;
        }

        @keyframes tailWag { 0%, 100% { transform: rotate(0deg); } 50% { transform: rotate(35deg); } }

        .orchid-branch {
            position: absolute; left: -25px; top: 10px;
            opacity: 0; display: flex; align-items: center;
            transform: rotate(-15deg) scale(0.5);
            transition: all 0.8s ease 1s; z-index: 10;
        }

        .stem { width: 45px; height: 4px; background: #4caf50; border-radius: 2px; }
        .orchid-flower { font-size: 26px; filter: drop-shadow(1px 1px 0 white); margin-left: -5px; }

        /* --- Fixed Butterfly --- */
        .butterfly-box { position: fixed; pointer-events: none; z-index: 100; }
        .butterfly { position: relative; width: 50px; height: 40px; transform: rotate(-15deg); }
        .bf-body { position: absolute; width: 25px; height: 5px; background: #333; border-radius: 10px; top: 20px; left: 10px; z-index: 2; }
        .wing {
            position: absolute; background: linear-gradient(135deg, #d4a5ff 0%, #9b67e6 100%);
            border: 1.5px solid #5a2d82; border-radius: 50% 50% 10% 50%;
            transform-origin: bottom center; opacity: 0.9;
        }
        .upper-wing { width: 35px; height: 30px; top: -5px; left: 5px; animation: wingFlap 0.4s infinite ease-in-out; z-index: 3; }
        .lower-wing { width: 25px; height: 20px; top: 5px; left: 0px; opacity: 0.7; animation: wingFlap 0.4s infinite ease-in-out 0.1s; z-index: 1; }

        @keyframes wingFlap { 0%, 100% { transform: skewY(0deg) scaleY(1); } 50% { transform: skewY(-20deg) scaleY(0.3); } }
        @keyframes flyAcross { from { right: -100px; transform: translateY(0); } to { right: 110vw; transform: translateY(-50px); } }

        /* --- Final Reveal --- */
        #message { display: none; position: absolute; text-align: center; color: var(--deep-violet); z-index: 50; }
        #message h1 { font-size: clamp(2.5rem, 10vw, 5rem); animation: popIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        .shake { animation: shake 0.3s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        .burst { animation: burstOut 0.8s ease-out forwards; }
        @keyframes burstOut { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(5); opacity: 0; } }

        .petal, .heart { position: fixed; top: -10%; pointer-events: none; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
    </style>
</head>
<body>

    <div class="main-wrapper" id="ui-container">
        <div id="envelope-container"></div>
        <div class="button-zone">
            <button id="dodge-btn">Open</button>
        </div>
    </div>

    <div id="message">
        <h1>I LOVEEE YOUUUU! LAAAAAAAB.<br>Happy Valentine's Day</h1>
    </div>

    <div id="cat-container">
        <div class="orchid-branch" id="orchids">
            <div class="stem"></div>
            <span class="orchid-flower">ðŸŒº</span>
            <span class="orchid-flower">ðŸŒº</span>
        </div>
        <div class="tail"></div>
        <div class="cat-body">
            <div class="cat-head">
                <div class="ear left"></div>
                <div class="ear right"></div>
                <div class="cat-face-mask">
                    <div class="eye left"></div>
                    <div class="eye right"></div>
                    <div class="nose"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const envelope = document.getElementById('envelope-container');
        const btn = document.getElementById('dodge-btn');
        const message = document.getElementById('message');
        const uiContainer = document.getElementById('ui-container');
        const cat = document.getElementById('cat-container');
        const orchids = document.getElementById('orchids');
        let clickCount = 0;

        // --- FIXED DODGE LOGIC ---
        function dodge() {
            // Increase range for mobile so it's harder to catch
            const rangeX = window.innerWidth > 500 ? 250 : 150; 
            const rangeY = window.innerWidth > 500 ? 150 : 100;
            
            const randomX = (Math.random() - 0.5) * rangeX * 2;
            const randomY = (Math.random() - 0.5) * rangeY * 2;
            
            btn.style.transform = `translate(${randomX}px, ${randomY}px)`;
        }

        // Mouse dodge (PC)
        btn.addEventListener('mouseover', dodge);

        // Touch dodge (Mobile) - triggers immediately when the finger starts to touch
        btn.addEventListener('touchstart', (e) => {
            e.preventDefault(); // Prevents the actual click/tap from happening easily
            dodge();
        });

        // 2. Click Logic for Envelope
        envelope.addEventListener('click', () => {
            clickCount++;
            envelope.classList.remove('shake');
            void envelope.offsetWidth; 
            envelope.classList.add('shake');

            if (clickCount >= 5) {
                envelope.classList.add('burst');
                btn.style.opacity = '0';
                btn.style.pointerEvents = 'none'; // Disable dodging after open
                setTimeout(() => {
                    uiContainer.style.display = 'none';
                    message.style.display = 'block';
                    revealCat(); 
                    startMagic();
                }, 600);
            }
        });

        function revealCat() {
            cat.style.bottom = "-20px"; 
            setTimeout(() => {
                orchids.style.opacity = "1";
                orchids.style.transform = "rotate(10deg) scale(1)";
            }, 1000);
        }

        function startMagic() {
            setInterval(createFalling, 300);
            setInterval(spawnButterfly, 1500);
        }

        function createFalling() {
            const item = document.createElement('div');
            const isHeart = Math.random() > 0.5;
            item.className = isHeart ? 'heart' : 'petal';
            item.innerHTML = isHeart ? 'ðŸ’œ' : 'ðŸŒ¸';
            item.style.left = Math.random() * 100 + 'vw';
            item.style.fontSize = (Math.random() * 20 + 15) + 'px';
            const dur = Math.random() * 3 + 4;
            item.style.animation = `fall ${dur}s linear forwards`;
            document.body.appendChild(item);
            setTimeout(() => item.remove(), dur * 1000);
        }

        function spawnButterfly() {
            const box = document.createElement('div');
            box.className = 'butterfly-box';
            box.innerHTML = `
                <div class="butterfly">
                    <div class="bf-body"></div>
                    <div class="wing lower-wing"></div>
                    <div class="wing upper-wing"></div>
                </div>
            `;
            const startTop = Math.random() * 70 + 10;
            box.style.top = startTop + 'vh';
            const dur = Math.random() * 4 + 6;
            box.style.animation = `flyAcross ${dur}s linear forwards`;
            document.body.appendChild(box);
            setTimeout(() => box.remove(), dur * 1000);
        }
    </script>
</body>
</html>  left: 50%;
  top: calc(50% + 100px);
  transform: translate(-50%, 0);
  font-size: 36px;
  font-weight: bold;
  color: #ffccff;
  user-select: none;
  pointer-events: none;
  transition: transform 0.3s ease, font-size 0.3s ease;
  z-index: 1;
}

#loveText {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  font-size: 48px;
  color: #ff99ff;
  text-shadow: 0 0 20px #ff66ff;
  z-index: 3;
  text-align: center;
  white-space: pre-line;
  transition: transform 2s ease-out;
}

#effects {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 4;
  overflow: hidden;
}

.flying-butterfly {
  position: absolute;
  width: 40px;
  height: 40px;
  fill: #aa55ff;
  z-index: 5;
}
</style>
</head>

<body>
<div class="container">

  <div class="chest" id="chest">
    <svg width="200" height="150" viewBox="0 0 200 150">
      <rect x="20" y="70" width="160" height="60" rx="10"
            fill="#6b3f95" stroke="#4b2170" stroke-width="4"/>
      <rect id="chest-lid" x="20" y="40" width="160" height="40" rx="10"
            fill="#7e4cb0" stroke="#4b2170" stroke-width="4"/>
    </svg>
  </div>

  <div id="openText">OPEN</div>
  <div id="loveText">Happy Valentines Day! I LOVE YOU LAB!</div>
  <div id="effects"></div>

</div>

<script>
const chest = document.getElementById('chest');
const chestLid = document.getElementById('chest-lid');
const loveText = document.getElementById('loveText');
const openText = document.getElementById('openText');
const effects = document.getElementById('effects');

/* ---------------- OPEN TEXT DODGE ---------------- */
let dodgeCount = 0;

document.addEventListener('mousemove', e => {
  const r = openText.getBoundingClientRect();
  const dx = e.clientX - (r.left + r.width / 2);
  const dy = e.clientY - (r.top + r.height / 2);
  if (Math.hypot(dx, dy) < 100) {
    dodgeCount++;
    openText.style.fontSize =
      Math.max(36 - dodgeCount * 1.5, 18) + "px";

    openText.style.transform =
      `translate(${(Math.random()-0.5)*400}px, ${(Math.random()-0.5)*400}px)`;
  }
});

/* ---------------- 5 CLICK CHEST LOGIC ---------------- */
let clickCount = 0;
let opened = false;

chest.addEventListener('click', () => {
  if (opened) return;

  clickCount++;

  /* small shake feedback (no UI text) */
  chest.style.transform =
    'translate(-50%, -50%) scale(0.97)';
  setTimeout(() => {
    chest.style.transform = 'translate(-50%, -50%)';
  }, 80);

  if (clickCount < 5) return;

  opened = true;

  chestLid.style.transition = 'transform 1s ease';
  chestLid.style.transformOrigin = 'bottom center';
  chestLid.style.transform = 'rotateX(-120deg)';

  setTimeout(() => {
    loveText.style.transform =
      'translate(-50%, -50%) scale(1)';
    startContinuousRain();
    startFlyingButterflies();
  }, 1000);
});

/* ---------------- FALLING ELEMENTS ---------------- */
function createFallingElement() {
  const types = ['heart','butterfly','petal'];
  const type = types[Math.floor(Math.random()*types.length)];

  const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
  const size = 20 + Math.random()*15;
  svg.setAttribute('width', size);
  svg.setAttribute('height', size);

  let shape;
  if (type === 'heart') {
    shape = document.createElementNS("http://www.w3.org/2000/svg","path");
    shape.setAttribute('d',
      'M10 3 C10 -2 0 -2 0 3 C0 8 10 18 10 18 C10 18 20 8 20 3 C20 -2 10 -2 10 3');
    shape.setAttribute('fill','#cc66ff');
  } else if (type === 'butterfly') {
    shape = document.createElementNS("http://www.w3.org/2000/svg","path");
    shape.setAttribute('d','M0,10 C5,0 15,0 20,10 C15,20 5,20 0,10 Z');
    shape.setAttribute('fill','#aa55ff');
  } else {
    shape = document.createElementNS("http://www.w3.org/2000/svg","ellipse");
    shape.setAttribute('cx',size/2);
    shape.setAttribute('cy',size/2);
    shape.setAttribute('rx',size/2);
    shape.setAttribute('ry',size/3);
    shape.setAttribute('fill','#dd99ff');
  }

  svg.appendChild(shape);
  svg.style.position = 'absolute';
  svg.style.left = Math.random()*innerWidth + 'px';
  svg.style.top = '-30px';
  svg.style.opacity = 0.8;
  svg.style.transition = 'transform 5s linear, opacity 2s ease';
  effects.appendChild(svg);

  setTimeout(() => {
    svg.style.transform =
      `translateY(${innerHeight+60}px)
       translateX(${Math.random()*60-30}px)
       rotate(${Math.random()*360}deg)`;
    svg.style.opacity = 0;
  }, 50);

  setTimeout(() => svg.remove(), 6000);
}

function startContinuousRain() {
  setInterval(createFallingElement, 200);
}

/* ---------------- FLYING BUTTERFLIES ---------------- */
function startFlyingButterflies() {
  for (let i=0;i<6;i++) createFlyingButterfly(i*150);
}

function createFlyingButterfly(delay) {
  const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
  svg.setAttribute('width','40');
  svg.setAttribute('height','40');
  svg.classList.add('flying-butterfly');

  const cx=20, cy=20;

  const left = document.createElementNS("http://www.w3.org/2000/svg","path");
  left.setAttribute('d',`M${cx},${cy} C5,5 2,15 10,20 C2,25 5,35 ${cx},${cy}`);
  left.setAttribute('fill','#aa55ff');

  const right = document.createElementNS("http://www.w3.org/2000/svg","path");
  right.setAttribute('d',`M${cx},${cy} C35,5 38,15 30,20 C38,25 35,35 ${cx},${cy}`);
  right.setAttribute('fill','#aa55ff');

  svg.append(left,right);
  document.body.appendChild(svg);

  let x=Math.random()*innerWidth;
  let dir=Math.random()>0.5?1:-1;
  let speed=1+Math.random();

  function move(){
    x+=dir*speed;
    if(x<0||x>innerWidth)dir*=-1;
    svg.style.left=x+'px';
    svg.style.bottom=30+Math.sin(x/50)*20+'px';
    requestAnimationFrame(move);
  }

  function flap(){
    left.setAttribute('transform','scale(1,0.7)');
    right.setAttribute('transform','scale(1,0.7)');
    setTimeout(()=>{
      left.setAttribute('transform','scale(1,1)');
      right.setAttribute('transform','scale(1,1)');
    },120);
    setTimeout(flap,240);
  }

  setTimeout(()=>{move();flap();},delay);
}
</script>
</body>
</html>

